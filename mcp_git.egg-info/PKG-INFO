Metadata-Version: 2.4
Name: mcp-git
Version: 0.1.0
Summary: Git operations MCP server for AI Agents
Author: Kirky.X
License: MIT
Keywords: git,mcp,ai-agent,model-context-protocol
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: mcp>=0.9.0
Requires-Dist: GitPython>=3.1.40
Requires-Dist: anyio>=4.0.0
Requires-Dist: asyncio-throttle>=1.0.2
Requires-Dist: aiosqlite>=0.19.0
Requires-Dist: pydantic>=2.5.0
Requires-Dist: python-dotenv>=1.0.0
Requires-Dist: secrecy>=1.2.0
Requires-Dist: loguru>=0.7.0
Requires-Dist: uuid6>=2024.1.12
Provides-Extra: dev
Requires-Dist: pytest>=7.4.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-cov>=4.1.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Requires-Dist: mypy>=1.7.0; extra == "dev"
Requires-Dist: pre-commit>=3.6.0; extra == "dev"

# mcp-git

A Python-based Git operations MCP (Model Context Protocol) server that provides a comprehensive interface for Git operations through the MCP protocol.

## Overview

mcp-git is an MCP server implementation that enables AI assistants and other MCP clients to perform Git operations through a well-defined protocol. It provides a complete set of Git operations including repository management, branching, committing, pushing, pulling, merging, and more.

### Key Features

- **Complete Git Operations**: Support for all common Git operations including clone, commit, push, pull, branch, merge, rebase, stash, tag, and more
- **Workspace Management**: Automatic workspace allocation and cleanup with LRU-based eviction
- **Task Queue**: Priority-based task queue with configurable concurrency limits
- **Worker Pool**: Automatic worker scaling for parallel task execution
- **SQLite Persistence**: Tasks and workspaces are persisted to SQLite for durability
- **Secure Credential Handling**: Support for tokens, SSH keys, and username/password authentication
- **MCP Protocol**: Full MCP protocol implementation for seamless integration with MCP clients

## Architecture

The project follows a 5-layer architecture:

```
┌─────────────────┐     ┌─────────────────┐
│  MCP Protocol   │────▶│ Business Logic  │
│     Layer       │     │     Layer       │
└─────────────────┘     └─────────────────┘
                               │
                               ▼
┌─────────────────┐     ┌─────────────────┐
│    Storage      │◀────│   Execution     │
│     Layer       │     │     Layer       │
└─────────────────┘     └─────────────────┘
```

### Layers

1. **MCP Protocol Layer** (`mcp_git/server/`): MCP server, tools, and handlers
2. **Business Logic Layer** (`mcp_git/service/`): Facade, TaskManager, WorkspaceManager, CredentialManager
3. **Execution Layer** (`mcp_git/execution/`): TaskQueue and WorkerPool
4. **Git Operations Layer** (`mcp_git/git/`): Git adapter interface and GitPython implementation
5. **Storage Layer** (`mcp_git/storage/`): SQLite storage and data models

## Installation

### Prerequisites

- Python 3.10+
- Git
- **uv** (recommended) or pip

---

## Quick Start with uv

[uv](https://docs.astral.sh/uv/) is a fast Python package installer and resolver, written in Rust.

### 1. Install uv

**macOS / Linux:**
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

**Windows (PowerShell):**
```powershell
irm https://astral.sh/uv/install.ps1 | iex
```

**Or using pip:**
```bash
pip install uv
```

### 2. Create Virtual Environment & Install

```bash
# Clone the repository
git clone https://github.com/yourusername/mcp-git.git
cd mcp-git

# Create virtual environment and install dependencies
uv venv
uv pip install -e .

# Install development dependencies
uv pip install -e ".[dev]"
```

### 3. Run the Server

```bash
# Activate virtual environment
source .venv/bin/activate  # Linux/macOS
# or
.venv\Scripts\activate     # Windows

# Run the MCP server
mcp-git
```

---

## Alternative Installation Methods

### Install from Source (pip)

```bash
# Clone the repository
git clone https://github.com/yourusername/mcp-git.git
cd mcp-git

# Install dependencies
pip install -e .
```

### Install from PyPI

```bash
pip install mcp-git
```

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `MCP_GIT_WORKSPACE_PATH` | Workspace root directory | `/tmp/mcp-git/workspaces` |
| `MCP_GIT_DATABASE_PATH` | SQLite database path | `/tmp/mcp-git/database/mcp-git.db` |
| `MCP_GIT_SERVER_PORT` | Server port | `3001` |
| `MCP_GIT_SERVER_TRANSPORT` | Transport type (stdio, sse) | `stdio` |
| `MCP_GIT_MAX_CONCURRENT_TASKS` | Maximum concurrent tasks | `10` |
| `MCP_GIT_TASK_TIMEOUT` | Task timeout in seconds | `300` |
| `MCP_GIT_GIT_TOKEN` | Git authentication token | - |
| `MCP_GIT_GITHUB_TOKEN` | GitHub authentication token | - |
| `MCP_GIT_SSH_KEY_PATH` | Path to SSH private key | - |

### Configuration File

Create a `config.yaml` file:

```yaml
workspace:
  path: "/tmp/mcp-git/workspaces"
  max_size_bytes: 10737418240  # 10GB
  retention_seconds: 3600

database:
  path: "/tmp/mcp-git/database/mcp-git.db"
  max_size_bytes: 104857600  # 100MB
  task_retention_seconds: 3600

server:
  host: "127.0.0.1"
  port: 3001
  transport: "stdio"

execution:
  max_concurrent_tasks: 10
  task_timeout: 300
  worker_count: 4
```

## Usage

### Running the Server

```bash
# Using the CLI
mcp-git

# Or with a custom config
mcp-git --config /path/to/config.yaml

# Using Python directly
python -m mcp_git.main
```

### Using with Claude Code

Add to your `CLAUDE.md` or MCP configuration:

```json
{
  "mcpServers": {
    "git": {
      "command": "mcp-git",
      "env": {
        "MCP_GIT_GITHUB_TOKEN": "your-token-here"
      }
    }
  }
}
```

### Available Tools

#### Workspace Management

- `git_allocate_workspace`: Allocate a new workspace for Git operations
- `git_get_workspace`: Get information about a workspace
- `git_release_workspace`: Release a workspace and clean up resources
- `git_list_workspaces`: List all allocated workspaces

#### Repository Operations

- `git_clone`: Clone a Git repository into a workspace
- `git_init`: Initialize a new Git repository
- `git_status`: Get repository status

#### Commit Operations

- `git_stage`: Stage files for commit
- `git_commit`: Create a new commit

#### Remote Operations

- `git_push`: Push commits to remote
- `git_pull`: Pull changes from remote
- `git_fetch`: Fetch from remote

#### Branch Operations

- `git_checkout`: Checkout a branch or commit
- `git_list_branches`: List branches
- `git_create_branch`: Create a new branch
- `git_delete_branch`: Delete a branch

#### Merge and Rebase

- `git_merge`: Merge a branch into current branch
- `git_rebase`: Rebase current branch

#### History Operations

- `git_log`: View commit history
- `git_show`: Show a specific commit
- `git_diff`: Show differences
- `git_blame`: Show blame information

#### Stash Operations

- `git_stash`: Stash changes
- `git_list_stash`: List stash entries

#### Tag Operations

- `git_list_tags`: List tags
- `git_create_tag`: Create a tag
- `git_delete_tag`: Delete a tag

#### Remote Operations

- `git_list_remotes`: List remotes
- `git_add_remote`: Add a remote
- `git_remove_remote`: Remove a remote

#### Task Operations

- `git_get_task`: Get task information
- `git_list_tasks`: List tasks
- `git_cancel_task`: Cancel a task

### Example Usage

```python
# Allocate a workspace
workspace = await server.allocate_workspace()
print(f"Workspace ID: {workspace['workspace_id']}")
print(f"Path: {workspace['path']}")

# Clone a repository
result = await server.clone(
    url="https://github.com/example/repo.git",
    workspace_id=workspace_id,
    branch="main",
    depth=1,
)
print(f"Cloned: {result['oid'][:8]} - {result['message']}")

# Stage and commit
await server.stage_files(workspace_id, files=["file.txt"])
commit_oid = await server.create_commit(
    workspace_id,
    message="Update file.txt",
    author_name="Your Name",
    author_email="you@example.com",
)

# Push to remote
await server.push(workspace_id, remote="origin", branch="main")

# Release workspace when done
await server.release_workspace(workspace_id)
```

## Development

### Setting Up Development Environment

```bash
# Clone the repository
git clone https://github.com/yourusername/mcp-git.git
cd mcp-git

# Create virtual environment and install with dev dependencies
uv venv
uv pip install -e ".[dev]"
```

### Running Tests

```bash
# Run all tests with uv
uv run pytest

# Run with coverage
uv run pytest --cov=mcp_git

# Run specific test file
uv run pytest tests/test_storage.py -v

# Run specific test
uv run pytest tests/test_workspace_manager.py::TestWorkspaceManager::test_allocate_workspace -v
```

### Code Formatting and Linting

```bash
# Format code with ruff
uv run ruff format .

# Run linter
uv run ruff check .

# Type checking with mypy
uv run mypy mcp_git/
```

### Pre-commit Hooks

```bash
# Install pre-commit hooks
uv run pre-commit install

# Run pre-commit manually
uv run pre-commit run --all-files
```

### Project Structure

```
mcp-git/
├── mcp_git/
│   ├── __init__.py
│   ├── main.py                 # Entry point
│   ├── config.py               # Configuration management
│   ├── error.py                # Error definitions
│   ├── git/
│   │   ├── __init__.py
│   │   ├── adapter.py          # Git adapter interface
│   │   └── adapter_gitpython.py # GitPython implementation
│   ├── storage/
│   │   ├── __init__.py
│   │   ├── models.py           # Data models
│   │   └── sqlite.py           # SQLite storage
│   ├── service/
│   │   ├── __init__.py
│   │   ├── facade.py           # Git service facade
│   │   ├── task_manager.py     # Task management
│   │   ├── workspace_manager.py # Workspace management
│   │   └── credential_manager.py # Credential handling
│   ├── execution/
│   │   ├── __init__.py
│   │   ├── task_queue.py       # Task queue
│   │   └── worker_pool.py      # Worker pool
│   └── server/
│       ├── __init__.py
│       ├── server.py           # MCP server
│       ├── tools.py            # Tool definitions
│       └── handlers.py         # Tool handlers
├── tests/
│   ├── __init__.py
│   ├── conftest.py            # Pytest fixtures
│   ├── test_config.py
│   ├── test_models.py
│   ├── test_storage.py
│   ├── test_workspace_manager.py
│   ├── test_task_manager.py
│   ├── test_git_adapter.py
│   ├── test_task_queue.py
│   └── test_worker_pool.py
├── pyproject.toml
└── README.md
```

### Adding New Git Operations

1. Add the operation to `mcp_git/git/adapter.py` as an abstract method
2. Implement in `mcp_git/git/adapter_gitpython.py`
3. Add to facade in `mcp_git/service/facade.py`
4. Add tool definition in `mcp_git/server/tools.py`
5. Add handler in `mcp_git/server/handlers.py`
6. Add tests

## Security Considerations

- Credentials are stored securely using the `secrecy` library
- Workspace paths are validated to prevent path traversal attacks
- Git operations run in isolated workspaces
- Task timeouts prevent hanging operations

## License

MIT License - see LICENSE file for details.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests
5. Submit a pull request

## Support

- Report issues on GitHub
- Check the documentation
- Review existing issues
